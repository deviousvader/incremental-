<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Incremental Game with Save, Offline Earnings & Upgrade Counts</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #d8cbb5;
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
    }
    #game {
        display: flex;
        flex: 1;
    }
    #main {
        flex: 2;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #eee2d0;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
    }
    #stats {
        font-size: 18px;
        margin-bottom: 20px;
        text-align: center;
    }
    #click-btn {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        font-size: 20px;
        background: #c49e68;
        border: 4px solid #8b6b3f;
        color: white;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 5px #6a512f;
    }
    #click-btn:active {
        transform: translateY(3px);
        box-shadow: 0 2px #6a512f;
    }
    #upgrades {
        flex: 1;
        background: #cbb79d;
        overflow-y: auto;
        padding: 10px;
        border-left: 3px solid #8b6b3f;
    }
    .upgrade-btn {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px;
        margin-bottom: 8px;
        background: #e5d4b5;
        border: 2px solid #a0865d;
        cursor: pointer;
        border-radius: 6px;
        font-size: 14px;
    }
    .upgrade-btn:disabled {
        background: #b9a68a;
        cursor: not-allowed;
    }
    .upgrade-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }
    .upgrade-name {
        font-weight: bold;
    }
    .upgrade-owned {
        font-size: 12px;
        color: #444;
    }
    #popup {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px 30px;
        background: #fff7d6;
        border: 3px solid #a0865d;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        display: none;
        font-size: 16px;
        text-align: center;
        animation: popupFade 2s ease-out;
        z-index: 1000;
    }
    @keyframes popupFade {
        0% {opacity: 0; transform: translate(-50%, -60%);}
        20% {opacity: 1; transform: translate(-50%, -50%);}
        80% {opacity: 1; transform: translate(-50%, -50%);}
        100% {opacity: 0; transform: translate(-50%, -40%);}
    }
</style>
</head>
<body>

<div id="game">
    <div id="main">
        <div id="stats">
            Coins: <span id="coins">0</span><br>
            Coins per click: <span id="cpc">1</span><br>
            Coins per second: <span id="cps">0</span>
        </div>
        <button id="click-btn" onclick="clickCoin()">Click Me</button>
    </div>
    <div id="upgrades"></div>
</div>

<div id="popup"></div>

<script>
    let coins = 0;
    let coinsPerClick = 1;
    let coinsPerSecond = 0;

    let upgrades = [
        { name: "Cursor", type: "cps", amount: 1, cost: 10, owned: 0 },
        { name: "Farm", type: "cps", amount: 5, cost: 50, owned: 0 },
        { name: "Mine", type: "cps", amount: 20, cost: 200, owned: 0 },
        { name: "Pickaxe", type: "cpc", amount: 1, cost: 15, owned: 0 },
        { name: "Drill", type: "cpc", amount: 5, cost: 75, owned: 0 },
      {name: "Factory", type: coinsPerClick, amount: 10, cost: 225, owned: 0} }
    ];

    function clickCoin() {
        coins += coinsPerClick;
        updateDisplay();
        saveGame();
    }

    function buyUpgrade(index) {
        let u = upgrades[index];
        if (coins >= u.cost) {
            coins -= u.cost;
            if (u.type === "cps") coinsPerSecond += u.amount;
            if (u.type === "cpc") coinsPerClick += u.amount;
            u.cost = Math.floor(u.cost * 1.5);
            u.owned++;
            updateDisplay();
            renderUpgrades();
            saveGame();
        }
    }

    function updateDisplay() {
        document.getElementById("coins").textContent = coins;
        document.getElementById("cpc").textContent = coinsPerClick;
        document.getElementById("cps").textContent = coinsPerSecond;
        document.querySelectorAll(".upgrade-btn").forEach((btn, i) => {
            btn.disabled = coins < upgrades[i].cost;
        });
    }

    function renderUpgrades() {
        let container = document.getElementById("upgrades");
        container.innerHTML = "";
        upgrades.forEach((u, i) => {
            let btn = document.createElement("button");
            btn.className = "upgrade-btn";
            btn.onclick = () => buyUpgrade(i);

            let info = document.createElement("div");
            info.className = "upgrade-info";

            let name = document.createElement("div");
            name.className = "upgrade-name";
            name.textContent = `${u.name} (+${u.amount} ${u.type.toUpperCase()})`;

            let owned = document.createElement("div");
            owned.className = "upgrade-owned";
            owned.textContent = `Owned: ${u.owned}`;

            info.appendChild(name);
            info.appendChild(document.createElement("div")).textContent = `Cost: ${u.cost} coins`;
            info.appendChild(owned);

            btn.appendChild(info);
            container.appendChild(btn);
        });
    }

    function showPopup(message) {
        const popup = document.getElementById("popup");
        popup.textContent = message;
        popup.style.display = "block";
        setTimeout(() => { popup.style.display = "none"; }, 2000);
    }

    setInterval(() => {
        coins += coinsPerSecond;
        updateDisplay();
        saveGame();
    }, 1000);

    function saveGame() {
        const saveData = {
            coins,
            coinsPerClick,
            coinsPerSecond,
            upgrades,
            lastSave: Date.now()
        };
        localStorage.setItem("incrementalSave", JSON.stringify(saveData));
    }

    function loadGame() {
        const saved = localStorage.getItem("incrementalSave");
        if (saved) {
            const data = JSON.parse(saved);
            coins = data.coins || 0;
            coinsPerClick = data.coinsPerClick || 1;
            coinsPerSecond = data.coinsPerSecond || 0;
            upgrades = data.upgrades || upgrades;

            if (data.lastSave) {
                const timeAwaySec = Math.floor((Date.now() - data.lastSave) / 1000);
                if (timeAwaySec > 0 && coinsPerSecond > 0) {
                    let earnings = 0;
                    const firstHour = Math.min(timeAwaySec, 3600);
                    const afterHour = Math.max(timeAwaySec - 3600, 0);

                    earnings += firstHour * coinsPerSecond * 0.05;
                    earnings += afterHour * coinsPerSecond * 0.005;

                    earnings = Math.floor(earnings);
                    coins += earnings;
                    showPopup(`While you were away (${timeAwaySec}s), you earned ${earnings} coins!`);
                }
            }
        }
    }

    loadGame();
    renderUpgrades();
    updateDisplay();
</script>

</body>
</html>
